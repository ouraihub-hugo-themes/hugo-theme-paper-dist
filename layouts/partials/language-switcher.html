{{- /*
Language Switcher Component

功能：
- 检查当前页面是否有翻译版本
- 如果有翻译，链接到翻译页面
- 如果没有翻译，尝试构建对应的目标语言页面 URL
- 显示语言代码（EN 或 中）
- 添加 aria-label 和 title

Requirements: 21.6
*/ -}}

{{- if hugo.IsMultilingual -}}
  {{- if .IsTranslated -}}
    {{- /* 当前页面有翻译版本 */ -}}
    {{- range .Translations -}}
      {{- $switchText := printf "Switch to %s" .Language.LanguageName -}}
      <a href="{{ .Permalink }}" class="focus-outline p-1 text-sm font-medium hover:text-accent" title="{{ $switchText }}" aria-label="{{ $switchText }}">
        {{- if eq .Language.Lang "zh" -}}中{{- else -}}EN{{- end -}}
      </a>
    {{- end -}}
  {{- else -}}
    {{- /* 当前页面没有翻译版本，尝试构建对应的目标语言页面 URL */ -}}
    {{- range .Site.Languages -}}
      {{- if ne .Lang $.Language.Lang -}}
        {{- $currentPath := $.RelPermalink -}}
        {{- $currentLang := $.Language.Lang -}}
        {{- $targetLang := .Lang -}}
        {{- $pathWithoutLang := $currentPath -}}
        
        {{- /* 移除当前语言前缀 */ -}}
        {{- if hasPrefix $currentPath (printf "/%s/" $currentLang) -}}
          {{- $pathWithoutLang = strings.TrimPrefix (printf "/%s/" $currentLang) $currentPath -}}
        {{- end -}}
        
        {{- /* 构建目标语言的 URL */ -}}
        {{- $targetURL := printf "/%s/%s" $targetLang $pathWithoutLang -}}
        {{- $switchText := printf "Switch to %s" .LanguageName -}}
        
        <a href="{{ $targetURL | relURL }}" class="focus-outline p-1 text-sm font-medium hover:text-accent" title="{{ $switchText }}" aria-label="{{ $switchText }}">
          {{- if eq .Lang "zh" -}}中{{- else -}}EN{{- end -}}
        </a>
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

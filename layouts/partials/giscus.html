<!-- Giscus 评论系统配置 -->
<!--
使用说明:
1. 访问 https://giscus.app 配置你的GitHub仓库
2. 在params.toml中设置以下配置:
   [params.comments]
   enable = true
   provider = "giscus"
   repo = "your-username/your-repo"
   repoId = "R_..."
   category = "General"
   categoryId = "DIC_..."
   mapping = "pathname"
   strict = "0"
   reactionsEnabled = "1"
   emitMetadata = "0"
   inputPosition = "bottom"
   theme = "light"
   lang = "en"
-->

{{ if and .Site.Params.comments.enable (eq .Site.Params.comments.provider "giscus") }}
<div class="giscus-wrapper mt-12 pt-8 border-t border-border">
  <h3 class="text-2xl font-bold mb-6">Comments</h3>

  <script src="https://giscus.app/client.js"
        data-repo="{{ .Site.Params.comments.repo }}"
        data-repo-id="{{ .Site.Params.comments.repoId }}"
        data-category="{{ .Site.Params.comments.category }}"
        data-category-id="{{ .Site.Params.comments.categoryId }}"
        data-mapping="{{ .Site.Params.comments.mapping | default "pathname" }}"
        data-strict="{{ .Site.Params.comments.strict | default "0" }}"
        data-reactions-enabled="{{ .Site.Params.comments.reactionsEnabled | default "1" }}"
        data-emit-metadata="{{ .Site.Params.comments.emitMetadata | default "0" }}"
        data-input-position="{{ .Site.Params.comments.inputPosition | default "bottom" }}"
        data-theme="{{ if (eq .Site.Params.theme.defaultTheme "dark") }}dark{{ else }}light{{ end }}"
        data-lang="{{ .Site.LanguageCode | default "en" }}"
        crossorigin="anonymous"
        async>
  </script>

  <!-- 深色模式动态切换脚本 -->
  <script>
    const giscusTheme = () => {
      const theme = document.documentElement.getAttribute('data-theme');
      const giscusFrame = document.querySelector('iframe.giscus-frame');
      if (giscusFrame) {
        giscusFrame.parentElement.classList.toggle('dark-mode', theme === 'dark');
      }
    };

    // 监听主题切换事件
    const observer = new MutationObserver(giscusTheme);
    observer.observe(document.documentElement, { attributes: true });
  </script>
</div>
{{ end }}
